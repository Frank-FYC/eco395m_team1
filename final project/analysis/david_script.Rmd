---
title: "Davids_R_Script"
author: "David Fraire"
date: "5/10/2019"
output: html_document
---
Code for loading Library Packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(foreign)
library(matrixStats)
library(readr)
library(FNN)
library(tidyverse)
library(datasets)
library(dbplyr)
library(dplyr)
library(ggformula)
library(ggplot2)
library(ggstance)
library(graphics)
library(grDevices)
library(haven)
library(lattice)
library(markdown)
library(Matrix)
library(methods)
library(mosaic)
library(mosaicData)
library(pander)
library(RColorBrewer)
library(stargazer)
library(stringr)
library(tidyr)
library(tidyverse)

```

#HS on PPVT Score
``` {r}
# Import data and begin analysis
final <- read.csv("../data/finaldataset.csv", header=TRUE)
demingfinal<-read_stata("../data/deming_final_data.dta")
View(demingfinal)
View(final)
summary(final,)
colnames(final)



# Linear and Generlized models
lmPPVT <- lm(headstart~PPVTat3, data=final)
lmPPVT <- lm(headstart ~ PPVTat3, data=final, na.action = na.omit)

coef(lmPPVT)
glmPPVT = glm(headstart~PPVTat3, data=final, family=binomial)
glmPPVT = glm(headstart~Hispanic + Black + Male + PPVTat3, data=final, family=binomial, na.action = na.omit)
glmPPVT = glm(headstart~ BirthWeight+hsgrad+FirstBorn + Hispanic + Black + Male  , data=final, family=binomial)
summary(final$PPVT)

final$glm1resid<- predict.glm(glm1) ## Predict function requires no NA's
final$glm2resid<- predict.glm(glm2) 

lm(headstart ~ glm2resid, data=final, family=binomial)

stargazer::stargazer(glm3, glm2, glm1, lm1,lm2,type="text", flip=TRUE)

```


#HS on College Enrollment
``` {r}
glmCE <- glm(somecollege~headstart, data=final, family=binomial)
lmCE<- lm(somecollege~headstart, data=final)

stargazer::stargazer(glmCE, lmCE, type="text", title="Regressions of HS on College Enrollment")



```


#HS on HSgrad
``` {r}

```


Research Question: What is the impact of Headstart in the short/long term effect on the participants, specifically the non-white children. 

Personal hypothesis (guided by provided research papers): Yes, the short term effect on non-white children will be more pronounced in the short-term and long-term. There might be a more pronounced "fade-out" effect in the white chidren, but overall the "fade-out" will be seen on average across the particpants.

First, we decided to use a Genearlized Linear Model to proceed with analysis of the effect of Headstart program on non-white participants. The 1st regression includes the following variables: birthweight, hsgrad, Firstborn, Hispanic, Black, Male. Birthweight


#Variable Creation
```{r}
```
 

#Data Manipulation from DM3
```{r}
ON$Entertainment <- ifelse(ON$data_channel_is_entertainment== 1,1,0)
ON$Social <- ifelse(ON$data_channel_is_socmed == 1, 2, 0)
ON$World <- ifelse(ON$data_channel_is_world == 1, 3, 0)
ON$Lifestyle <- ifelse(ON$data_channel_is_lifestyle == 1, 4, 0)
ON$Business <- ifelse(ON$data_channel_is_bus == 1, 5, 0)
ON$Tech <- ifelse(ON$data_channel_is_tech == 1, 6, 0)
ON$Category_num = ON$Entertainment + ON$Social + ON$World + ON$Lifestyle + ON$Business + ON$Tech
ON$Category = factor(ON$Category_num, levels=0:6, 
                    labels=c("Misc","Entertainment","Social","World", "Lifestyle","Business", "Tech" ))




```

#KNN modeling Code w/ rmse for accuracy check
```{r}
library(readr)
library(psycho)
library(tidyverse)
library(dplyr)
library(FNN)

### DATASET <- DATASETNAME %>% psycho::standardize()
rmse = function(y, yhat) {sqrt(mean((y - yhat)^2))}
K = 100
rmsevals = do(K)*{
  n = nrow(final)
  n_train = round(0.8*n)  # round to nearest integer
  n_test = n - n_train
  train_cases = sample.int(n, n_train, replace=FALSE)
  test_cases = setdiff(1:n, train_cases)
  final_train = final[train_cases,]
  final_test = final[test_cases,]
  x_train = select(final_train, c(-compscoreage15, -compscoreage16, -compscoreage17, -compscoreage18,))
  y_train = select(final_train, headstart)
  x_test = select(final_test, c(-compscoreage15, -compscoreage16, -compscoreage17, -compscoreage18,))
  y_test = select(SH_test, price)
  
  knn5 = knn.reg(train=x_train, test = x_test, y = y_train, k=5)
  ypred_knn5 = knn5$pred
  knn20 = knn.reg(train=x_train, test = x_test, y = y_train, k=20)
  ypred_knn20 = knn20$pred
  knn50 = knn.reg(train=x_train, test = x_test, y = y_train, k=50)
  ypred_knn50 = knn50$pred
  knn70 = knn.reg(train=x_train, test = x_test, y = y_train, k=70)
  ypred_knn70 = knn70$pred
  knn100 = knn.reg(train=x_train, test = x_test, y = y_train, k=100)
  ypred_knn100 = knn100$pred
  knn200 = knn.reg(train=x_train, test = x_test, y = y_train, k=200)
  ypred_knn200 = knn200$pred
  knn300 = knn.reg(train=x_train, test = x_test, y = y_train, k=300)
  ypred_knn300 = knn300$pred
  c(rmse(SH_test$price, ypred_knn5), rmse(SH_test$price, ypred_knn20), rmse(SH_test$price, ypred_knn50), rmse(SH_test$price, ypred_knn70), rmse(SH_test$price, ypred_knn100), rmse(SH_test$price, ypred_knn200), rmse(SH_test$price, ypred_knn300))
}
colMeans(rmsevals)
NN <- c(5, 20, 50, 70 ,100, 200, 300)
plot(colMeans(rmsevals) ~ NN, main = "RMSE vs number of neighbors", ylab="RMSE", xlab = "Number of Neighbors", type = 'l')
```

#RMSE 
```{r}
rmse_vals.std = do(500)*{
  n = nrow(__)
  n_train = round(0.8*n)  # round to nearest integer
  n_test = n - n_train
  train_cases = sample.int(n, n_train, replace=FALSE)
  test_cases = setdiff(1:n, train_cases)
  df_train = __[train_cases,]
  df_test = __[test_cases,]

   bestmodelname <- lm(head_start ~  , data = "datasetname")
 
 
  yhat_test3 = predict("bestmodelname", df_test)
  rmse("testdataset"$, yhat_test3)
}
colMeans(rmse_vals.std)




```

#Plots
```{r}

## Violin Plot of x on y
ggplot(final, aes(x=headstart, y=))+
  geom_violin(aes(fill=Category))+
  labs(title="",
       y="",
       x="")+
  ylim(0,10000) ## 
  
  
  

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
